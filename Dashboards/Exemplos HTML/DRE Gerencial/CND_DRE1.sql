SELECT SYSDATE AS DTREF,
       REFERENCIA,
       AD_SKJV2,
       NROUNICOBP,
       ANALISE_CR_M,
       ANALISE_CR_U,
       CTACTB,
       CODCENCUS,
       CODPROJ,
       SKJV,
       AD_CATEGORIA,
       STATUS,
       CODDIRETORIA,
       DIRETORIA,
       CR_NOVO,
       NVL((CASE WHEN PLAN.CTACTB LIKE '3.1.1.01.%' OR PLAN.CTACTB LIKE '3.1.1.03.%' THEN PLAN.VLRLANC ELSE 0 END), 0) AS REC_BRUT_U,
       NVL((CASE WHEN PLAN.CTACTB LIKE '3.1.1.01.%' OR PLAN.CTACTB IN ('7.1.1.01.00001', '7.1.1.01.00002') THEN PLAN.VLRLANC ELSE 0 END),0) AS REC_BRUT_MC,
       NVL((CASE WHEN PLAN.CTACTB LIKE '3.1.1.05.%' AND PLAN.CTACTB NOT IN ('3.1.1.05.00006', '3.1.1.05.00007') THEN PLAN.VLRLANC ELSE 0 END), 0) AS IMPOSTO,
       NVL((CASE WHEN PLAN.CTACTB LIKE '3.1.1.03%' OR PLAN.CTACTB LIKE '7.1.1.03.00002' THEN PLAN.VLRLANC ELSE 0 END), 0) AS REPASSE,
       NVL((CASE WHEN PLAN.CTACTB LIKE '4.1.%' AND PLAN.CTACTB NOT IN ('4.1.2.01.00006','4.1.2.01.00007','4.1.2.01.00008','4.1.2.01.00009','4.1.2.01.00010') /*comissões de terceiros*/ THEN PLAN.VLRLANC ELSE 0 END), 0) AS CUSTOS,
       NVL((CASE WHEN PLAN.CTACTB LIKE '4.1.%' AND PLAN.CTACTB NOT IN ('4.1.2.01.00006','4.1.2.01.00007','4.1.2.01.00008','4.1.2.01.00009','4.1.2.01.00010') /*comissões de terceiros*/
                                   AND PLAN.CODCENCUS NOT IN (1001111,1001112,1001113,1001127,1001128,1001115,1001116,1001117,1001118,2001211,2001212,2001213,2001215,2001218,2001219,
                                                          10001401, 10001402, 10001403, 10001404, 10001405, 10001406, 10001407, 10001501, 10001502, 10001503, 10001504)
                 THEN PLAN.VLRLANC ELSE 0 END),0) AS CUSTOS_SER,
       NVL((CASE WHEN PLAN.CTACTB LIKE '4.1.%' AND PLAN.CTACTB NOT IN ('4.1.2.01.00006','4.1.2.01.00007','4.1.2.01.00008','4.1.2.01.00009','4.1.2.01.00010') /*comissões de terceiros*/
                                   AND PLAN.CODCENCUS IN (1001111,1001112,1001113,1001127,1001128,1001115,1001116,1001117,1001118,2001211,2001212,2001213,2001215,2001218,2001219,
                                                          10001401, 10001402, 10001403, 10001404, 10001405, 10001406, 10001407, 10001501, 10001502, 10001503, 10001504)
                 THEN PLAN.VLRLANC ELSE 0 END),0) AS CUSTOS_IND,
       NVL((CASE WHEN PLAN.CTACTB IN ('4.1.2.01.00006', '4.1.2.01.00007', '4.1.2.01.00008', '4.1.2.01.00009', '4.1.2.01.00010', /*comissões de terceiros - serviço*/
                                      '5.1.2.01.00006', '5.1.2.01.00007', '5.1.2.01.00008', '5.1.2.01.00009', '5.1.2.01.00010', /*comissões de terceiros - comercial*/
                                      '5.2.2.01.00006', '5.2.2.01.00007', '5.2.2.01.00008', '5.2.2.01.00009', '5.2.2.01.00010', /*comissões de terceiros - administrativa*/
                                      '7.1.1.03.00001'/*Unidade Próprias (Compensação)*/)
                 THEN PLAN.VLRLANC ELSE 0 END),0) AS REPASSE_UNI,
       NVL((CASE WHEN PLAN.CTACTB LIKE '5.1.%' AND PLAN.CTACTB NOT IN ('5.1.2.01.00006', '5.1.2.01.00007', '5.1.2.01.00008', '5.1.2.01.00009', '5.1.2.01.00010') /*comissões de terceiros*/
                 THEN PLAN.VLRLANC ELSE 0 END), 0) AS DESP_COM,
       NVL((CASE WHEN PLAN.CTACTB LIKE '5.2.%' AND PLAN.CTACTB NOT IN ('5.2.2.01.00006', '5.2.2.01.00007', '5.2.2.01.00008', '5.2.2.01.00009', '5.2.2.01.00010') /*comissões de terceiros*/
                 THEN PLAN.VLRLANC ELSE 0 END), 0) AS DESP_ADM,
       NVL((CASE WHEN PLAN.CTACTB LIKE '5.3.%' THEN PLAN.VLRLANC ELSE 0 END),0) AS DESP_OUT,
       NVL((CASE WHEN PLAN.CTACTB LIKE '5.4.1.%' THEN PLAN.VLRLANC ELSE 0 END),0) AS REC_FIN,
       NVL((CASE WHEN PLAN.CTACTB LIKE '5.4.2.%' THEN PLAN.VLRLANC ELSE 0 END),0) AS DESP_FIN,
       NVL((CASE WHEN PLAN.CTACTB LIKE '5.5.1.01.%' THEN PLAN.VLRLANC ELSE 0 END), 0) AS IR_S_LCR,
       NVL((CASE WHEN PLAN.CTACTB = '5.5.1.02.00001' THEN PLAN.VLRLANC ELSE 0 END), 0) AS CS_S_LCR,
       NVL((CASE WHEN PLAN.CTACTB LIKE '5.5.1.%' THEN PLAN.VLRLANC ELSE 0 END), 0) AS IRPJ_CSLL,
       NVL((CASE WHEN PLAN.CTACTB LIKE '5.1.6.%' OR PLAN.CTACTB LIKE '4.1.6.%' OR PLAN.CTACTB LIKE '5.2.6.%' THEN PLAN.VLRLANC ELSE 0 END), 0) AS DEP_AM_EX,
       /*Solicitação da OS 1438917 para que essa regra do ajustes seja desfeita para o ano de 2019
       NVL((CASE WHEN PLAN.CTACTB IN ('5.3.2.03.00001', '5.3.2.03.00002') AND TO_CHAR(REFERENCIA, 'YYYY') < 2019 THEN PLAN.VLRLANC*-1 
                 WHEN PLAN.CTACTB = '5.3.2.03.00001' AND TO_CHAR(REFERENCIA, 'YYYY') >= 2019 THEN PLAN.VLRLANC*-1 ELSE 0 END), 0)*/ 
       NVL((CASE WHEN PLAN.CTACTB IN ('5.3.2.03.00001', '5.3.2.03.00002') THEN PLAN.VLRLANC*-1 END),0) AS AJUSTES,
       PLAN.CODEMP
  FROM CND_DRE0 PLAN
 WHERE (PLAN.CTACTB LIKE '3.1.1.01.%'
     OR PLAN.CTACTB LIKE '3.1.1.03.%'
     OR PLAN.CTACTB LIKE '3.1.1.05.%'
     OR PLAN.CTACTB IN ('7.1.1.01.00001',
                        '7.1.1.01.00002',
                        '7.1.1.03.00001',
                        '7.1.1.03.00002')
     OR PLAN.CTACTB LIKE '4.1.%'
     OR PLAN.CTACTB LIKE '5.1.%'
     OR PLAN.CTACTB LIKE '5.2.%'
     OR PLAN.CTACTB LIKE '5.3.%'
     OR PLAN.CTACTB LIKE '5.4.1.%'
     OR PLAN.CTACTB LIKE '5.4.2.%'
     OR PLAN.CTACTB LIKE '5.5.1.%'
     OR PLAN.CTACTB LIKE '5.5.6.%')